function defineCloud(e){function t(e,t,a){if(void 0===t)throw"Argument "+e+" was not provided!";if(typeof t!=a)throw"Argument "+e+" was an unexpected type! Expected: "+a+", Received: "+typeof t}function a(t,a,i,r){e.debug&&Ti.API.info('ACS Request: { url: "'+t+'", verb: "'+a+'", data: '+JSON.stringify(i)+" })"),m.send(t,a,i,function(t){if(r){var a=t.response||{};t.meta&&"ok"==t.meta.status?(a.success=!0,a.error=!1,a.meta=t.meta,e.debug&&Ti.API.info(JSON.stringify(a))):(a.success=!1,a.error=!0,a.code=t.meta?t.meta.code:t.statusCode,a.message=t.meta?t.meta.message:t.message||t.statusText,e.debug&&Ti.API.error(a.code+": "+a.message)),r(a)}})}function i(e,i){t("data",e,"object"),t("callback",i,"function"),o(this),this.url||(this.url=this.restNamespace+"/"+this.restMethod+".json"),a(this.url,this.verb,e,i)}function r(){i.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function o(e){e.restNamespace||(e.restNamespace=e.property.toLowerCase()),e.restMethod||(e.restMethod=e.method.toLowerCase())}function n(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var a=Array(80),i=1732584193,r=-271733879,o=-1732584194,n=271733878,d=-1009589776,s=0;s<e.length;s+=16){for(var c=i,u=r,h=o,T=n,w=d,m=0;80>m;m++){a[m]=16>m?e[s+m]:(a[m-3]^a[m-8]^a[m-14]^a[m-16])<<1|(a[m-3]^a[m-8]^a[m-14]^a[m-16])>>>31;var U,f=i<<5|i>>>27;U=20>m?r&o|~r&n:40>m?r^o^n:60>m?r&o|r&n|o&n:r^o^n,f=l(l(f,U),l(l(d,a[m]),20>m?1518500249:40>m?1859775393:60>m?-1894007588:-899497514)),d=n,n=o,o=r<<30|r>>>2,r=i,i=f}i=l(i,c),r=l(r,u),o=l(o,h),n=l(n,T),d=l(d,w)}return[i,r,o,n,d]}function l(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function d(e){for(var t=[],a=(1<<w)-1,i=0;i<e.length*w;i+=w)t[i>>5]|=(e.charCodeAt(i/w)&a)<<32-w-i%32;return t}function s(e,t,a,i,r){var o=!1;return this.appKey=e,this.oauthKey=t,this.oauthSecret=a,this.apiBaseURL=i?i:c.sdk.url.baseURL,this.authBaseURL=r?r:c.sdk.url.authBaseURL,this.useThreeLegged=function(e){o=e,this.oauthKey||(this.oauthKey=this.appKey)},this.isThreeLegged=function(){return o},this}var c,u={PROPERTY_TYPE_ONLY_LATEST:0,PROPERTY_TYPE_SLASH_COMBINE:1,PROPERTY_TYPE_IGNORE:2};u.build=function U(e,t){var a,i=t.children||[];for(a in i)if(i.hasOwnProperty(a)){var r=i[a],o=r.propertyTypes||t.propertyTypes||{};o.children=u.PROPERTY_TYPE_IGNORE;for(var n in t)if(t.hasOwnProperty(n))switch(o[n]||u.PROPERTY_TYPE_ONLY_LATEST){case u.PROPERTY_TYPE_ONLY_LATEST:r[n]=void 0===r[n]?t[n]:r[n];break;case u.PROPERTY_TYPE_SLASH_COMBINE:var l=[];t[n]&&l.push(t[n]),r[n]&&l.push(r[n]),r[n]=l.join("/")}r.method&&!r.children?e[r.method]=function(e){return function(){return e.executor.apply(e,arguments)}}(r):r.property&&U(e[r.property]={},r)}},u.build(e,{verb:"GET",executor:i,children:[{method:"sendRequest",executor:function(e,i){t("params",e,"object"),t("url",e.url,"string"),t("method",e.method,"string"),t("callback",i,"function"),a(e.url,e.method,e.data?e.data:{},i)}},{method:"createX509CertificatePinningSecurityManager",executor:function(e){var t=!0;try{var a=require("appcelerator.https")}catch(i){Ti.API.error(i+" SecurityManager not set."),t=!1}t&&(e=a.createX509CertificatePinningSecurityManager(e),c.js.sdk.utils.setSecurityManager(e))}},{method:"hasStoredSession",executor:function(){return Ti.API.warn("Cloud.hasStoredSession has been deprecated. Use Cloud.sessionId property"),m.hasStoredSession()}},{method:"retrieveStoredSession",executor:function(){return Ti.API.warn("Cloud.retrieveStoredSession has been deprecated. Use Cloud.sessionId property"),m.retrieveStoredSession()}},{property:"ACLs",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"addUser",restMethod:"add",verb:"POST"},{method:"removeUser",restMethod:"remove",verb:"DELETE"},{method:"checkUser",restMethod:"check"}]},{property:"Chats",children:[{method:"create",verb:"POST"},{method:"query"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"queryChatGroups",restMethod:"query_chat_groups",executor:r},{method:"getChatGroups",restMethod:"get_chat_groups",executor:r}]},{property:"Checkins",children:[{method:"create",verb:"POST"},{method:"query",executor:r},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Clients",children:[{method:"geolocate",executor:r}]},{property:"Objects",executor:function(e,a){var r;e&&"object"==typeof e&&(t("data.classname",e.classname,"string"),o(this),this.url=this.restNamespace+"/"+e.classname+"/"+this.restMethod+".json",r=e.classname,delete e.classname),i.call(this,e,a),e.classname=r},children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query"}]},{property:"Emails",restNamespace:"custom_mailer",children:[{method:"send",verb:"POST",restMethod:"email_from_template"}]},{property:"Events",children:[{method:"create",verb:"POST"},{method:"show"},{method:"showOccurrences",restMethod:"show/occurrences"},{method:"query",executor:r},{method:"queryOccurrences",restMethod:"query/occurrences",executor:r},{method:"search",executor:r},{method:"searchOccurrences",restMethod:"search/occurrences",executor:r},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Files",children:[{method:"create",verb:"POST"},{method:"query",executor:r},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Friends",children:[{method:"add",verb:"POST"},{method:"requests",executor:r},{method:"approve",verb:"PUT"},{method:"remove",verb:"DELETE"},{method:"search"}]},{property:"GeoFences",restNamespace:"geo_fences",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query"}]},{property:"KeyValues",children:[{method:"set",verb:"PUT"},{method:"get"},{method:"append",verb:"PUT"},{method:"increment",restMethod:"incrby",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Likes",children:[{method:"create",verb:"POST"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Messages",children:[{method:"create",verb:"POST"},{method:"reply",verb:"POST"},{method:"show"},{method:"showInbox",restMethod:"show/inbox",executor:r},{method:"showSent",restMethod:"show/sent",executor:r},{method:"showThreads",restMethod:"show/threads",executor:r},{method:"showThread",restMethod:"show/thread"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"removeThread",restMethod:"delete/thread",verb:"DELETE"}]},{property:"Photos",children:[{method:"create",verb:"POST"},{method:"show"},{method:"search"},{method:"query",executor:r},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PhotoCollections",restNamespace:"collections",children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"search"},{method:"showSubcollections",restMethod:"show/subcollections"},{method:"showPhotos",restMethod:"show/photos"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Places",children:[{method:"create",verb:"POST"},{method:"search",executor:r},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query",executor:r}]},{property:"Posts",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query",executor:r},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PushNotifications",restNamespace:"push_notification",verb:"POST",children:[{method:"subscribe"},{method:"unsubscribe",verb:"DELETE"},{method:"notify"},{method:"query",verb:"GET"},{method:"subscribeToken",restMethod:"subscribe_token"},{method:"unsubscribeToken",restMethod:"unsubscribe_token",verb:"DELETE"},{method:"updateSubscription",restMethod:"subscription/update",verb:"PUT"},{method:"notifyTokens",restMethod:"notify_tokens"},{method:"resetBadge",restMethod:"reset_badge",verb:"PUT"},{method:"setBadge",restMethod:"set_badge",verb:"PUT",executor:r},{method:"queryChannels",restMethod:"channels/query",verb:"GET",executor:r},{method:"showChannels",restMethod:"channels/show",verb:"GET"}]},{property:"PushSchedules",restNamespace:"push_schedules",children:[{method:"create",restMethod:"create",verb:"POST"},{method:"query",restMethod:"query",executor:r},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Reviews",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"SocialIntegrations",restNamespace:"users",children:[{method:"externalAccountLogin",restMethod:"external_account_login",verb:"POST"},{method:"externalAccountLink",restMethod:"external_account_link",verb:"POST"},{method:"externalAccountUnlink",restMethod:"external_account_unlink",verb:"DELETE"},{method:"searchFacebookFriends",restNamespace:"social",restMethod:"facebook/search_friends",executor:r}]},{property:"Statuses",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"show"},{method:"search"},{method:"query",executor:r},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Users",children:[{method:"create",verb:"POST"},{method:"login",verb:"POST"},{method:"show"},{method:"showMe",restMethod:"show/me",executor:function(e){i.call(this,{},e)}},{method:"search",executor:r},{method:"query",executor:r},{method:"update",verb:"PUT"},{method:"logout",executor:function(e){i.call(this,{},function(t){m.reset(),e(t)})}},{method:"remove",restMethod:"delete",verb:"DELETE",executor:function(){var e=arguments;i.call(this,2==e.length?e[0]:{},function(t){m.reset(),(2==e.length?e[1]:e[0])(t)})}},{method:"requestResetPassword",restMethod:"request_reset_password"},{method:"resendConfirmation",restMethod:"resend_confirmation"}]}]});var h;null==h&&(h={}),h.setProperties=function(e,t){if(null!=e&&null!=t)for(var a in t)e[a]=t[a];return e},h.setProperties(h,{percentEncode:function(e){if(null==e)return"";if(e instanceof Array){for(var t="";0<e.length;++e)""!=t&&(t+="&"),t+=h.percentEncode(e[0]);return t}return e=encodeURIComponent(e),e=e.replace(/\!/g,"%21"),e=e.replace(/\*/g,"%2A"),e=e.replace(/\'/g,"%27"),e=e.replace(/\(/g,"%28"),e=e.replace(/\)/g,"%29")},decodePercent:function(e){return null!=e&&(e=e.replace(/\+/g," ")),decodeURIComponent(e)},getParameterList:function(e){if(null==e)return[];if("object"!=typeof e)return h.decodeForm(e+"");if(e instanceof Array)return e;var t,a=[];for(t in e)a.push([t,e[t]]);return a},getParameterMap:function(e){if(null==e)return{};if("object"!=typeof e)return h.getParameterMap(h.decodeForm(e+""));if(e instanceof Array){for(var t={},a=0;a<e.length;++a){var i=e[a][0];void 0===t[i]&&(t[i]=e[a][1])}return t}return e},getParameter:function(e,t){if(!(e instanceof Array))return h.getParameterMap(e)[t];for(var a=0;a<e.length;++a)if(e[a][0]==t)return e[a][1];return null},formEncode:function(e){for(var t="",e=h.getParameterList(e),a=0;a<e.length;++a){var i=e[a][1];null==i&&(i=""),""!=t&&(t+="&"),t+=h.percentEncode(e[a][0])+"="+h.percentEncode(i)}return t},decodeForm:function(e){for(var t=[],e=e.split("&"),a=0;a<e.length;++a){var i=e[a];if(""!=i){var r,o=i.indexOf("=");0>o?(r=h.decodePercent(i),i=null):(r=h.decodePercent(i.substring(0,o)),i=h.decodePercent(i.substring(o+1))),t.push([r,i])}}return t},setParameter:function(e,t,a){var i=e.parameters;if(i instanceof Array){for(e=0;e<i.length;++e)i[e][0]==t&&(void 0===a?i.splice(e,1):(i[e][1]=a,a=void 0));void 0!==a&&i.push([t,a])}else i=h.getParameterMap(i),i[t]=a,e.parameters=i},setParameters:function(e,t){for(var a=h.getParameterList(t),i=0;i<a.length;++i)h.setParameter(e,a[i][0],a[i][1])},completeRequest:function(e,t){null==e.method&&(e.method="GET");var a=h.getParameterMap(e.parameters);null==a.oauth_consumer_key&&h.setParameter(e,"oauth_consumer_key",t.consumerKey||""),null==a.oauth_token&&null!=t.token&&h.setParameter(e,"oauth_token",t.token),null==a.oauth_version&&h.setParameter(e,"oauth_version","1.0"),null==a.oauth_timestamp&&h.setParameter(e,"oauth_timestamp",h.timestamp()),null==a.oauth_nonce&&h.setParameter(e,"oauth_nonce",h.nonce(6)),h.SignatureMethod.sign(e,t)},setTimestampAndNonce:function(e){h.setParameter(e,"oauth_timestamp",h.timestamp()),h.setParameter(e,"oauth_nonce",h.nonce(6))},addToURL:function(e,t){if(newURL=e,null!=t){var a=h.formEncode(t);0<a.length&&(newURL=0>e.indexOf("?")?newURL+"?":newURL+"&",newURL+=a)}return newURL},getAuthorizationHeader:function(e,t){for(var a='OAuth realm="'+h.percentEncode(e)+'"',i=h.getParameterList(t),r=0;r<i.length;++r){var o=i[r],n=o[0];0==n.indexOf("oauth_")&&(a+=","+h.percentEncode(n)+'="'+h.percentEncode(o[1])+'"')}return a},correctTimestamp:function(e){h.timeCorrectionMsec=1e3*e-(new Date).getTime()},timeCorrectionMsec:0,timestamp:function(){var e=(new Date).getTime()+h.timeCorrectionMsec;return Math.floor(e/1e3)},nonce:function(e){for(var t=h.nonce.CHARS,a="",i=0;e>i;++i)var r=Math.floor(Math.random()*t.length),a=a+t.substring(r,r+1);return a}}),h.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",h.declareClass=function(e,t,a){var i=e[t];if(e[t]=a,null!=a&&null!=i)for(var r in i)"prototype"!=r&&(a[r]=i[r]);return a},h.declareClass(h,"SignatureMethod",function(){}),h.setProperties(h.SignatureMethod.prototype,{sign:function(e){var t=this.getSignature(h.SignatureMethod.getBaseString(e));return h.setParameter(e,"oauth_signature",t),t},initialize:function(e,t){var a;a=null!=t.accessorSecret&&9<e.length&&"-Accessor"==e.substring(e.length-9)?t.accessorSecret:t.consumerSecret,this.key=h.percentEncode(a)+"&"+h.percentEncode(t.tokenSecret)}}),h.setProperties(h.SignatureMethod,{sign:function(e,t){var a=h.getParameterMap(e.parameters).oauth_signature_method;(null==a||""==a)&&(a="HMAC-SHA1",h.setParameter(e,"oauth_signature_method",a)),h.SignatureMethod.newMethod(a,t).sign(e)},newMethod:function(e,t){var a=h.SignatureMethod.REGISTERED[e];if(null!=a){var i=new a;return i.initialize(e,t),i}var a=Error("signature_method_rejected"),r="";for(i in h.SignatureMethod.REGISTERED)""!=r&&(r+="&"),r+=h.percentEncode(i);throw a.oauth_acceptable_signature_methods=r,a},REGISTERED:{},registerMethodClass:function(e,t){for(var a=0;a<e.length;++a)h.SignatureMethod.REGISTERED[e[a]]=t},makeSubclass:function(e){var t=h.SignatureMethod,a=function(){t.call(this)};return a.prototype=new t,a.prototype.getSignature=e,a.prototype.constructor=a},getBaseString:function(e){var t=e.action,a=t.indexOf("?");if(0>a)a=e.parameters;else for(var a=h.decodeForm(t.substring(a+1)),i=h.getParameterList(e.parameters),r=0;r<i.length;++r)a.push(i[r]);return h.percentEncode(e.method.toUpperCase())+"&"+h.percentEncode(h.SignatureMethod.normalizeUrl(t))+"&"+h.percentEncode(h.SignatureMethod.normalizeParameters(a))},normalizeUrl:function(e){var t=h.SignatureMethod.parseUri(e),e=t.protocol.toLowerCase(),a=t.authority.toLowerCase();if("http"==e&&80==t.port||"https"==e&&443==t.port){var i=a.lastIndexOf(":");i>=0&&(a=a.substring(0,i))}return(t=t.path)||(t="/"),e+"://"+a+t},parseUri:function(e){for(var t="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(","),e=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),a={},i=14;i--;)a[t[i]]=e[i]||"";return a},normalizeParameters:function(e){if(null==e)return"";for(var t=h.getParameterList(e),e=[],a=0;a<t.length;++a){var i=t[a];"oauth_signature"!=i[0]&&e.push([h.percentEncode(i[0])+" "+h.percentEncode(i[1]),i])}for(e.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),t=[],a=0;a<e.length;++a)t.push(e[a][1]);return h.formEncode(t)}}),h.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],h.SignatureMethod.makeSubclass(function(){return this.key})),h.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],h.SignatureMethod.makeSubclass(function(e){T="=";var t=this.key,a=d(t);16<a.length&&(a=n(a,t.length*w));for(var i=Array(16),t=Array(16),r=0;16>r;r++)i[r]=909522486^a[r],t[r]=1549556828^a[r];for(e=n(i.concat(d(e)),512+e.length*w),e=n(t.concat(e),672),a="",t=0;t<4*e.length;t+=3)for(i=(e[t>>2]>>8*(3-t%4)&255)<<16|(e[t+1>>2]>>8*(3-(t+1)%4)&255)<<8|e[t+2>>2]>>8*(3-(t+2)%4)&255,r=0;4>r;r++)a=8*t+6*r>32*e.length?a+T:a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-r)&63);return a}));var T="",w=8;s.prototype.sendRequest=function(e,t,a,i){var r=c.js.sdk.utils.getAuthType(this);if(r==c.constants.unknown)i(c.constants.noAppKeyError);else{var o=this.apiBaseURL+"/"+c.sdk.url.version+"/"+e,o=r==c.constants.app_key?o+(c.constants.keyParam+this.appKey):o+(c.constants.oauthKeyParam+this.oauthKey);if(null==a&&(a={}),t=t?t.toUpperCase():c.constants.get_method,a[c.constants.suppressCode]="true",!this.isThreeLegged()){var n=c.js.sdk.utils.getCookie(c.constants.sessionId);n||(n=this.session_id),n&&(o=-1!=o.indexOf("?")?o+("&"+c.constants.sessionId+"="+n):o+("?"+c.constants.sessionId+"="+n))}if(this.isThreeLegged()&&(!this.accessToken&&(n=this.getSession())&&(this.accessToken=n.access_token),this.accessToken&&(a[c.constants.accessToken]=this.accessToken)),n=a,Ti.App.analytics){var l=n.analytics||{};l.id=Ti.Platform.createUUID(),Ti.Platform.id&&(l.mid=Ti.Platform.id),l.aguid=Ti.App.guid,l.event="cloud."+e.replace(/\//g,".").replace(/\.json/,""),l.deploytype=Ti.App.deployType||"development",l.sid=Ti.App.sessionId,n.ti_analytics=JSON.stringify(l)}if(a=c.js.sdk.utils.cleanInvalidData(a),e=c.js.sdk.utils.getFileObject(a)){try{var d;if(d=e.toString().match(/TiFilesystemFile/)?e.read():e,!d)return void i(c.constants.fileLoadError);a[c.constants.file]?(delete a[c.constants.file],a[c.constants.file]=d):a[c.constants.photo]&&(delete a[c.constants.photo],a[c.constants.photo]=d)}catch(s){return void i(c.constants.fileLoadError)}d={},(r==c.constants.oauth||r==c.constants.three_legged_oauth)&&(r={method:t,action:o,parameters:[]},c.js.sdk.utils.populateOAuthParameters(r.parameters,this.oauthKey),this.oauthSecret&&h.completeRequest(r,{consumerSecret:this.oauthSecret}),d[c.constants.oauth_header]=h.getAuthorizationHeader("",r.parameters))}else if(d={},r==c.constants.oauth||r==c.constants.three_legged_oauth){var u,r={method:t,action:o,parameters:[]};for(u in a)a.hasOwnProperty(u)&&r.parameters.push([u,a[u]]);c.js.sdk.utils.populateOAuthParameters(r.parameters,this.oauthKey),this.oauthSecret&&h.completeRequest(r,{consumerSecret:this.oauthSecret}),d[c.constants.oauth_header]=h.getAuthorizationHeader("",r.parameters)}c.js.sdk.utils.sendAppceleratorRequest(o,t,a,d,i,this)}},s.prototype.sendAuthRequest=function(e){if(c.js.sdk.utils.getAuthType(this)!==c.constants.three_legged_oauth)alert("wrong authorization type!");else{var e=e||{},t=this.authBaseURL,t=t+"/oauth/authorize"+(c.constants.oauthKeyParam+this.oauthKey),t=t+(c.constants.clientIdParam+this.oauthKey),t=t+(c.constants.responseTypeParam+"token"),e=e.params||{};e.action="login",e.url=t;var a=this,i=e.cb;i&&delete e.cb,c.js.sdk.ui(e,function(e){a.saveSession(e),i&&i(e)})}},s.prototype.signUpRequest=function(e){if(c.js.sdk.utils.getAuthType(this)!==c.constants.three_legged_oauth)alert("wrong authorization type!");else{var e=e||{},t=this.authBaseURL,t=t+"/users/sign_up"+(c.constants.oauthKeyParam+this.oauthKey),t=t+(c.constants.clientIdParam+this.oauthKey),e=e.params||{};e.action="signup",e.url=t;var a=this,i=e.cb;i&&delete e.cb,c.js.sdk.ui(e,function(e){a.saveSession(e),i&&i(e)})}},s.prototype.saveSession=function(e){return e&&e.access_token?(c.js.sdk.utils.setCookie(c.constants.accessToken,e.access_token),c.js.sdk.utils.setCookie(c.constants.expiresIn,e.expires_in),this.accessToken=e.access_token,this.expiresIn=e.expires_in,this.authorized=!0):this.authorized=!1},s.prototype.getSession=function(){var e={};return e.access_token=c.js.sdk.utils.getCookie(c.constants.accessToken),e.expires_in=c.js.sdk.utils.getCookie(c.constants.expiresIn),e.access_token?(this.accessToken=e.access_token,this.expiresIn=e.expires_in,this.authorized=!0,e):this.authorized=!1},s.prototype.clearSession=function(){c.js.sdk.utils.setCookie(c.constants.accessToken,""),c.js.sdk.utils.setCookie(c.constants.expiresIn,""),delete this.accessToken,delete this.expiresIn,this.authorized=!1},s.prototype.checkStatus=function(){return this.getSession()?!0:!1},c=void 0,c={constants:{},js:{}},c.js.sdk={},c.js.sdk.utils={},c.sdk={},c.sdk.url={},c.sdk.url.baseURL="https://api.cloud.appcelerator.com",c.sdk.url.authBaseURL="https://secure-identity.cloud.appcelerator.com",c.sdk.url.version="v1",c.constants.get_method="GET",c.constants.post_method="POST",c.constants.put_method="PUT",c.constants.delete_method="DELETE",c.constants.app_key=1,c.constants.oauth=2,c.constants.three_legged_oauth=3,c.constants.unknown=-1,c.constants.keyParam="?key=",c.constants.oauthKeyParam="?oauth_consumer_key=",c.constants.clientIdParam="&client_id=",c.constants.redirectUriParam="&redirect_uri=",c.constants.responseTypeParam="&response_type=",c.constants.accessToken="access_token",c.constants.expiresIn="expires_in",c.constants.appKey="app_key",c.constants.json="json",c.constants.sessionId="_session_id",c.constants.sessionCookieName="Cookie",c.constants.responseCookieName="Set-Cookie",c.constants.file="file",c.constants.suppressCode="suppress_response_codes",c.constants.response_wrapper="response_wrapper",c.constants.photo="photo",c.constants.method="_method",c.constants.name="name",c.constants.value="value",c.constants.oauth_header="Authorization",c.constants.noAppKeyError={meta:{status:"fail",code:409,message:"Application key is not provided."}},c.constants.fileLoadError={meta:{status:"fail",code:400,message:"Unable to load file"}},c.js.sdk.utils.getSessionParams=function(){var e=null,t=c.js.sdk.utils.getCookie(c.constants.sessionId);return t&&(e=c.constants.sessionId+"="+t),e},c.js.sdk.utils.cookieMap=[],c.js.sdk.utils.cookieMap[c.constants.sessionId]="sessionId",c.js.sdk.utils.cookieMap[c.constants.accessToken]="accessToken",c.js.sdk.utils.cookieMap[c.constants.expiresIn]="expiresIn",c.js.sdk.utils.securityManager=null,c.js.sdk.utils.getCookie=function(t){return(t=c.js.sdk.utils.cookieMap[t])&&e[t]||null},c.js.sdk.utils.setCookie=function(t,a){var i=c.js.sdk.utils.cookieMap[t];i&&(""===a?delete e[i]:e[i]=a)},c.js.sdk.utils.deleteCookie=function(t){(t=c.js.sdk.utils.cookieMap[t])&&delete e[t]},c.js.sdk.utils.getAuthType=function(e){if(e){if(e.isThreeLegged())return c.constants.three_legged_oauth;if(e.appKey)return c.constants.app_key;if(e.oauthKey&&e.oauthSecret)return c.constants.oauth}return c.constants.unknown},c.js.sdk.utils.getFileObject=function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)&&(t==c.constants.photo||t==c.constants.file))return e[t];return null},c.js.sdk.utils.cleanInvalidData=function(e){if(e){for(var t in e)if(e.hasOwnProperty(t)){if(null==e[t]&&delete e[t],"object"==typeof e[t]){if(t==c.constants.photo||t==c.constants.file)continue;e[t]=JSON.stringify(e[t])}(!0===e[t]||!1===e[t])&&(e[t]=e[t]?1:0)}return e}return{}},c.js.sdk.utils.uploadMessageCallback=function(e){return e&&e.data?JSON.parse(e.data):{}},c.js.sdk.utils.getOAuthParameters=function(e){var t="";if(e)for(var e=h.getParameterList(e),a=0;a<e.length;++a){var i=e[a],r=i[0];0==r.indexOf("oauth_")&&"oauth_token"!=r&&(t+="&"+h.percentEncode(r)+"="+h.percentEncode(i[1]))}return 0<t.length&&(t=t.substring(1)),t},c.js.sdk.utils.populateOAuthParameters=function(e,t){e&&t&&(e.push(["oauth_version","1.0"]),e.push(["oauth_consumer_key",t]),e.push(["oauth_signature_method","HMAC-SHA1"]),e.push(["oauth_nonce",h.nonce(15)]))},c.js.sdk.utils.sendAppceleratorRequest=function(t,a,i,r,o,n){var l=Ti.Network.createHTTPClient({timeout:6e4,onsendstream:function(a){e.onsendstream&&e.onsendstream({url:t,progress:a.progress})},ondatastream:function(a){e.ondatastream&&e.ondatastream({url:t,progress:a.progress})},onerror:function(e){var t={};if(this.responseText){var a=this.responseText;try{(a=a.trim())&&0<a.length&&(t=JSON.parse(a))}catch(i){t=i}}t.message||(t.message=e.error),t.error=!0,t.statusText=this.statusText,t.status=this.status,t.meta&&(t.metaString=JSON.stringify(t.meta)),o(t)},onload:function(){var e=JSON.parse(this.responseText);if(e&&e.meta&&(e.metaString=JSON.stringify(e.meta),e.meta.session_id)){var t=e.meta.session_id;c.js.sdk.utils.setCookie(c.constants.sessionId,t),n.session_id=t}o(e)},securityManager:c.js.sdk.utils.securityManager}),d=t;if(a.toUpperCase()==c.constants.get_method||a.toUpperCase()==c.constants.delete_method){var s,u="";for(s in i)i.hasOwnProperty(s)&&(u+="&"+s+"="+h.percentEncode(i[s]));0<u.length&&(d=0<t.indexOf("?")?d+u:d+("?"+u.substring(1)),i={})}if(e.debug&&(Ti.API.info(a+": "+d),Ti.API.info("header: "+JSON.stringify(r)),Ti.API.info("data: "+JSON.stringify(i))),l.open(a,d),"mobileweb"!=Ti.Platform.osname&&l.setRequestHeader("Accept-Encoding","gzip,deflate"),r)for(s in r)r.hasOwnProperty(s)&&l.setRequestHeader(s,r[s]);l.send(i)},c.js.sdk.utils.decodeQS=function(e){var t,a,i=decodeURIComponent,r={},e=e.split("&");for(t=0;t<e.length;t++)(a=e[t].split("=",2))&&a[0]&&(r[i(a[0])]=i(a[1]));return r},c.js.sdk.utils.guid=function(){return"f"+(1073741824*Math.random()).toString(16).replace(".","")},c.js.sdk.utils.copy=function(e,t,a,i){for(var r in t)(a||"undefined"==typeof e[r])&&(e[r]=i?i(t[r]):t[r]);return e},c.js.sdk.utils.setSecurityManager=function(e){c.js.sdk.utils.securityManager=e};var m={session:null,fetchSetting:function(e,t){var a,i="production"==Ti.App.deployType.toLowerCase()?"production":"development";return(a=Ti.App.Properties.getString(e+"-"+i))&&"undefined"!=a||(a=Ti.App.Properties.getString(e))&&"undefined"!=a?a:t},fetchSession:function(){var e=m.fetchSetting("acs-api-key",null),t=m.fetchSetting("acs-base-url",c.sdk.url.baseURL),a=m.fetchSetting("acs-authbase-url",c.sdk.url.authBaseURL),i=m.fetchSetting("acs-oauth-key",null),r=m.fetchSetting("acs-oauth-secret",null);return new s(e,i,r,t,a)}};return m.getSession=function(){return null==m.session&&(m.session=m.fetchSession()),m.session},m.send=function(e,t,a,i){m.getSession().sendRequest(e,t,a,i)},m.hasStoredSession=function(){return!!c.js.sdk.utils.getCookie(c.constants.sessionId)},m.retrieveStoredSession=function(){return c.js.sdk.utils.getCookie(c.constants.sessionId)},m.reset=function(){c.js.sdk.utils.deleteCookie(c.constants.sessionId),m.session&&(m.session.clearSession(),m.session=null)},m.secureSend=function(e,t){var a=m.getSession();a.useThreeLegged(!0),"secureCreate"===e?a.signUpRequest(t):"secureLogin"===e&&a.sendAuthRequest(t)},m.checkStatus=function(){return m.getSession().checkStatus()},c.js.sdk.UIManager={redirect_uri:"acsconnect://success",displayModal:function(t){function a(e){var t=/^acsconnect:\/\/([^#]*)#(.*)/.exec(decodeURIComponent(e.url));if(t&&3==t.length){var d=null;if("success"==t[1])d=c.js.sdk.utils.decodeQS(t[2]);else if("cancel"!=t[1])return;n.removeEventListener("beforeload",a),n.removeEventListener("load",a),i=d,null!=r?r.close():o&&o.close()}l&&"load"==e.type&&(o.remove(l),l=null)}e.debug&&Ti.API.info("ThreeLegged Request url: "+t.url);var i,r=null,o=Ti.UI.createWindow({fullscreen:!1,title:t.params.title||"Appcelerator Cloud Service"}),n=Ti.UI.createWebView({url:t.url,scalesPageToFit:!1,showScrollbars:!0}),l=Ti.UI.createLabel({text:"Loading, please wait...",color:"black",width:Ti.UI.SIZE||"auto",height:Ti.UI.SIZE||"auto",zIndex:100});if(n.addEventListener("beforeload",a),n.addEventListener("load",a),o.addEventListener("close",function(){t&&(t.cb&&t.cb(i),n=o=l=t=i=null)}),"android"!=Ti.Platform.osname){var d=Ti.UI.createButton({title:"close",width:"50%",height:"20%"});d.addEventListener("click",function(){r.close()}),o.rightNavButton=d,("iphone"==Ti.Platform.osname||"ios"==Ti.Platform.osname)&&(r=Ti.UI.iOS.createNavigationWindow({window:o}))}o.add(n),o.add(l),null!=r?r.open({modal:!0}):o.open()},processParams:function(e,t){return{cb:t,url:e.url+c.constants.redirectUriParam+c.js.sdk.UIManager.redirect_uri,params:e}}},c.js.sdk.ui=function(e,t){if("mobileweb"===Ti.Platform.osname)alert("Three Legged OAuth is not currently supported on MobileWeb");else if(e.action){var a=c.js.sdk.UIManager.processParams(e,t);a&&c.js.sdk.UIManager.displayModal(a)}else alert('"action" is a required parameter for com.cocoafish.js.sdk.ui().')},e}defineCloud(exports);